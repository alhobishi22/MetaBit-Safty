# MetaBit KYC Telegram Bot

هذا التطبيق يقوم بتوفير واجهة برمجية لاستلام طلبات التوثيق (KYC) وإرسالها إلى بوت تيليجرام للموافقة من قبل المشرفين.

## المميزات

- استقبال طلبات التوثيق من تطبيق الويب
- إرسال الطلبات إلى مجموعة المشرفين في تيليجرام
- إمكانية قبول أو رفض الطلبات من خلال أزرار تفاعلية
- بوت تيليجرام مدمج للتواصل مع المستخدمين
- حفظ طلبات التوثيق في قاعدة البيانات
- إرسال كود التسجيل للمستخدم عند قبول الطلب عبر تيليجرام
- إرسال سبب الرفض للمستخدم عند رفض الطلب عبر تيليجرام

## متطلبات التشغيل

- Python 3.9+
- FastAPI
- python-telegram-bot
- uvicorn
- dotenv
- psycopg2 (لقاعدة البيانات PostgreSQL)

## التثبيت

```
pip install -r requirements.txt
```

## إعداد المتغيرات البيئية

قم بإنشاء ملف `.env` يحتوي على:

```
TELEGRAM_BOT_TOKEN=your_bot_token
ADMIN_GROUP_ID=your_admin_group_id
DATABASE_URL=your_postgresql_url
```

## تهيئة قاعدة البيانات

لتهيئة قاعدة البيانات، قم بتشغيل:

```
python init_db.py
```

## التشغيل المحلي

```
python main.py
```

## النشر على Render

لنشر التطبيق على منصة Render، اتبع الخطوات التالية:

1. قم بإنشاء حساب على [Render](https://render.com/)
2. قم بربط مستودع GitHub الخاص بك
3. انقر على "New" واختر "Web Service"
4. اختر مستودع التطبيق الخاص بك
5. أدخل الإعدادات التالية:
   - Name: metabit-kyc-v2
   - Environment: Python
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `python main.py`
   
6. أضف متغيرات البيئة التالية:
   - `TELEGRAM_BOT_TOKEN`: توكن بوت التلغرام
   - `ADMIN_GROUP_ID`: معرف مجموعة الإدارة
   - `DATABASE_URL`: رابط قاعدة البيانات

7. انقر على "Create Web Service"

ملاحظة: يمكنك أيضًا استخدام ملف `render.yaml` للنشر التلقائي.

## واجهات البرمجة

- `POST /api/kyc-submission`: استلام طلبات التوثيق من تطبيق الويب
- `GET /api/kyc-status/{application_id}`: التحقق من حالة طلب التوثيق
- `GET /test-telegram`: اختبار الاتصال بالتيليجرام

## تفاعل المشرف مع الطلبات

عندما يصل طلب جديد إلى مجموعة المشرفين على تيليجرام، يمكن للمشرف:

1. **قبول الطلب**: بالضغط على زر "قبول"، ثم إدخال كود التسجيل بالصيغة `code_REQUEST-ID_REGISTRATION-CODE`
2. **رفض الطلب**: بالضغط على زر "رفض"، ثم إدخال سبب الرفض بالصيغة `reject_REQUEST-ID_REASON`

سيتم إعلام المستخدم تلقائيًا بالنتيجة عبر تيليجرام.

## أوامر البوت

- `/start`: بدء التفاعل مع البوت والوصول إلى صفحة التوثيق
